<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <script src="/scripts/jquery-1.7.2.min.js"></script>
        <script src="scripts/datajs-1.0.3.js"></script>
        <script type="text/javascript" src="scripts/q.js"></script>
        <script src="/scripts/jaydata/jaydata.js"></script>
        <script src="scripts/jaydata/jaydataproviders/oDataProvider.js"></script>
        <script src="/scripts/JaySvcUtil.js"></script>
        <script src="scripts/knockout-2.1.0.debug.js"></script>
        <script type="text/javascript" src="scripts/jaydata/jaydatamodules/qDeferred.js"></script>
        <script src="scripts/jaygrid-table-template.js"></script>
        <script src="scripts/jaygrid.js"></script>
        <script src="scripts/jay-property-editor.js"></script>
        <script src="scripts/jaydata/jaydatamodules/knockout.js"></script>
        <script src="scripts/JayStormClient/data-manager.js"></script>
        <script src="scripts/JayStormClient/schema-manager.js"></script>
        <script src="scripts/JayStormClient/service-manager.js"></script>
        <script src="scripts/JayStormClient/security-manager.js"></script>
        <script src="scripts/application.js"></script>

        <script src="scripts/inflection.js"></script>
        <script type="text/javascript">
        </script>
    </head>
<body>
    <div id="output">
    </div>

    <script type="text/html" id="foobar">
        <table>

        </table>
    </script>


    <ul id="MenuUI" data-bind="foreach:items">
        <li>
            <a href="#" data-bind="click: $root.show, text: Title"></a>
        </li>
    </ul>

    <div id="DataManagerUI" data-bind="if: visible">
        <h3>Manage data</h3>


        <h4>Select database</h4>
        <select data-bind="options: databases, value: serviceUrlSelected, optionsCaption:'Select database to manage'"></select>

        <div data-bind="foreach: entitySets">
            <a href="#"  data-bind="click: $root.selectSet, text: $data.collectionName"></a>
        </div>


        <div id="x567" data-bind="jayGrid: {
                        source: collection,
                        pageSize: esPageSize}">

        </div>

    </div>

    <div id="SchemaManagerUI" data-bind="if: context">
        <h3>Manage Database Schemas</h3>
        <h4>Select database to manage</h4>
        <select data-bind="options: databases, optionsCaption: 'Select database',
                            optionsText: 'Name',
                            value: $root.selectedDatabase">

        </select>

        <ul data-bind="foreach: databases">
            <li>
                <a href="#" data-bind="text: Name, click: $root.selectDatabase"></a>
            </li>
        </ul>
        <h4>Tables | ComplexTypes</h4>

        <div data-bind="if: currentDatabase">
            <table>
                <tr>
                    <td>
                        <h3>Database details</h3>

                        <h5>List of tables</h5>
                        <div data-bind="jayGrid: {
                                    source: context().EntitySets,
                                    itemCommands: tableCommands,
                                    fields: ['Name','Published'],
                                    discriminatorColumn: 'DatabaseID',
                                    beforeSave: beforeDatabaseSave,
                                    discriminatorValue: currentDatabaseID,
                                    pageSize: eSetsPageSize},
                                    visible: currentDatabase">

                        </div>

                    </td>
                    <td>
                        <div data-bind="visible: selectedEntity">
                            <form data-bind="submit: saveEntity">
                                <fieldset data-bind="with: selectedEntity">
                                    Table item name: <span data-bind="text: Name"></span>,
                                    Namespace: <span data-bind="text: Namespace"></span>
                                </fieldset>
                            </form>
                            <h5>List of FIELDS</h5>
                            <div data-bind="jayGrid: {
                                        source: context().EntityFields,
                                        fields:['Index', 'Name','TypeTemplate','ElementType','Key','Computed','Required'],
                                        sortColumn: 'Index',
                                        afterAddNew: afterAddNewEntityField,
                                        discriminatorColumn: 'EntityID',
                                        discriminatorValue: currentEntityID,
                                        defaultValues: { 'DatabaseID' : currentDatabaseID },
                                        pageSize: eSetsPageSize},
                                        visible: currentDatabase">

                                <script type="text/html" data-name-template="TypeTemplate-editor">
                                    <select data-bind="options:$root.typeTemplates, optionsText:'Name', optionsValue: 'Name',
                                            value: value,
                                            optionsCaption: value() ? undefined : 'Select'"></select>
                                </script>

                                <script type="text/html" data-name-template="ElementType-editor">
                                    <div data-bind="if: owner.TypeTemplate() === 'Array'">
                                    <select data-bind="options:$root.elementTypes,
                                            optionsText:'Name',
                                            optionsValue: 'TypeName',
                                            value:  value,
                                            optionsCaption: value() ? undefined :  'Select...'"></select>
                                    </div>

                                </script>

                                <script type="text/html" data-field-template="Roles">
                                    <div data-bind="text: $data"></div>
                                </script>
                            </div>
                        </div>

                    </td>

                </tr>

            </table>
            <table>
            </table>

        </div>
    </div>

    <div id="ServiceManagerUI" data-bind="if: context">

        <h3>Services</h3>

        <div id="svcGrid" data-bind="jayGrid: { source: context().Services,
                                                context: context,
                                                fields: ['Name','DatabaseID'],
                                                allDatabases: allDatabases,
                                                databaseSet: context().Databases}">

            <!--, dbs: databases, databases: context().Databases-->
            <script type="text/html" data-name-template="DatabaseID-editor">
                <select data-bind="options: $root.allDatabases,
                            optionsValue: 'DatabaseID', optionsText: 'Name', value: $parent[name],
                            optionsCaption: 'Select...' "></select>
            </script>

            <script type="text/html" data-name-template="DatabaseID-display">
                <span data-bind="readValue: { source: $root.databaseSet, key: $parent[name], field: 'Name' }"></span>
            </script>

            <script type="text/html" data-name-template="Sets-editor">
                <a href="#" data-bind="click: $root.selectService.bind({}, $parent)">#</a>
            </script>

        </div>


        <div data-bind="if: selectedService">
            <div id="entitySets" data-bind="jayGrid: {
                                                    source: context().EntitySetPublications,
                                                    context: context,
                                                    fields: 'EntitySetID'
                                                    discriminatorColumn: 'ServiceID',
                                                    discriminatorValue: selectedService().ServiceID,
                                                    allDatabases: allDatabases,
                                                    databaseSet: context().Databases}">


                <script type="text/html" data-name-template="Publish-display">
                    <span data-bind="text: $root.checkBoxStates().length"></span>
                    <input type="checkbox"
                           data-bind="click: $root.check,
                                      checked: $root.checkBoxStates().length < 1" />
                </script>


                <!--, dbs: databases, databases: context().Databases-->
                <script type="text/html" data-name-template="DatabaseID-editor">
                    <select data-bind="options: $root.allDatabases,
                                optionsValue: 'DatabaseID', optionsText: 'Name', value: $parent[name],
                                optionsCaption: 'Select...' "></select>
                </script>

                <script type="text/html" data-name-template="DatabaseID-display">
                    <span data-bind="text: $parent[name]" />:
                    <span data-bind="readValue: { source: $root.databaseSet, key: $parent[name], field: 'Name' }"></span>
                </script>



            </div>
        </div>


    </div>

    <div id="SecurityManagerUI" data-bind="if: context">
        <h4>Add new permission</h4>
        <form data-bind="submit: addPermission">
            <select data-bind="options: databases, optionsText:'Name', value: selectedDatabase, optionsCaption:'All databases'"></select>
            <select data-bind="options: tables, optionsText:'Name',  value: selectedTable, optionsCaption:'All tables'"></select>
            <select data-bind="options: groups, optionsText:'Name',  value: selectedGroup, optionsCaption:'All groups'"></select>

        <span data-bind="foreach: tablePermissions">
            <span data-bind="text: name"></span><input type="checkbox" data-bind="checked: value" />
        </span>


        <input type="submit" value="Add permission" />
        </form>
        <h4>List of active permissions</h4>

        <div data-bind="jayGrid: {source: context().Permissions,
                items: $root.items }">

            <script type="text/html" data-name-template="DatabaseID-display">
                <span data-bind="readValue: { source: $root.context().Databases, key: value, field: 'Name' }"></span>
            </script>
            <script type="text/html" data-name-template="EntitySetID-display">
                <span data-bind="readValue: { source: $root.context().EntitySets, key: value, field: 'Name' }"></span>
            </script>
            <script type="text/html" data-name-template="GroupID-display">
                <span data-bind="readValue: { source: $root.context().Groups, key: value, field: 'Name' }"></span>
            </script>
        </div>
    </div>

</body>
</html>