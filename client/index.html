<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <title>JayStorm Admin</title>

    <link rel="shortcut icon" type="image/x-icon" href="/img/jaystorm_favicon.png">

    <link href="styles/bootstrap.min.css" rel="stylesheet" />
    <link href="styles/style.css" rel="stylesheet" />
    <link href="styles/fileuploader.css" rel="stylesheet" />

    <script src="/scripts/jquery-1.7.2.min.js"></script>
    <script src="/scripts/fileuploader.js"></script>
    <script src="scripts/bootstrap.min.js"></script>
    <script src="scripts/datajs-1.0.3-patched.js"></script>
    <script type="text/javascript" src="scripts/q.js"></script>
    <script src="/scripts/jaytracer.js"></script>
    <script src="/scripts/jaydata/jaydata.js"></script>
    <script src="scripts/JaySvcUtil.js"></script>

    <script src="scripts/jaydata/jaydataproviders/oDataProvider.js"></script>
    <script src="scripts/jaydata/jaydataproviders/MongoDbProvider.js"></script>
    <script src="scripts/knockout-latest.js"></script>
    <script type="text/javascript" src="scripts/jaydata/jaydatamodules/qDeferred.js"></script>
    <script src="scripts/jaygrid-table-template.js"></script>
    <script src="scripts/jaygrid.js"></script>
    <script src="scripts/jay-property-editor.js"></script>
    
    <script src="scripts/jaydata/jaydatamodules/knockout.js"></script>
    <script src="scripts/JayStormClient/service-app-base.js"></script>
    <script src="scripts/JayStormClient/users-groups.js"></script>
    <script src="scripts/JayStormClient/data-manager.js"></script>
    <script src="scripts/JayStormClient/schema-manager.js"></script>
    <script src="scripts/JayStormClient/service-manager.js"></script>
    <script src="scripts/JayStormClient/security-manager.js"></script>
    <script src="scripts/JayStormClient/access-manager.js"></script>
    <script src="scripts/JayStormClient/staticfile-manager.js"></script>
    <script src="scripts/JayStormClient/deployment-manager.js"></script>
    <script src="scripts/JayStormClient/package-manager.js"></script>
    <script src="scripts/JayStormClient/access-clients.js"></script>
    <script src="scripts/application.js"></script>

    <script src="scripts/ejs.js"></script>

    <script src="scripts/codemirror/lib/codemirror.js" type="text/javascript"></script>
    <link rel="stylesheet" href="scripts/codemirror/lib/codemirror.css" type="text/css">
    <script src="scripts/codemirror/mode/javascript/javascript.js" type="text/javascript"></script>

    <script src="scripts/codemirror/lib/util/simple-hint.js" type="text/javascript"></script>
    <link rel="stylesheet" href="scripts/codemirror/lib/util/simple-hint.css" type="text/css">

    <script src="scripts/codemirror/lib/util/javascript-hint.js" type="text/javascript"></script>

    <script src="scripts/codemirror/mode/javascript/javascript.js" type="text/javascript"></script>
    <script src="scripts/codemirror/mode/xml/xml.js" type="text/javascript"></script>
    <script src="scripts/codemirror/mode/css/css.js" type="text/javascript"></script>
    <script src="scripts/codemirror/mode/htmlmixed/htmlmixed.js" type="text/javascript"></script>
    <script src="scripts/codemirror/mode/clike/clike.js" type="text/javascript"></script>
    <script src="scripts/codemirror/mode/ruby/ruby.js" type="text/javascript"></script>
    <script src="scripts/codemirror/mode/php/php.js" type="text/javascript"></script>

    <script src="scripts/codemirror/lib/util/searchcursor.js" type="text/javascript"></script>
    <script src="scripts/codemirror/lib/util/match-highlighter.js" type="text/javascript"></script>
    <script src="scripts/codemirror/lib/util/runmode.js" type="text/javascript"></script>

    <link rel="stylesheet" href="scripts/codemirror/theme/night.css" type="text/css">
    <link rel="stylesheet" href="scripts/codemirror/theme/ambiance.css" type="text/css">

    <script src="scripts/jshint.js" type="text/javascript"></script>
    <script src="scripts/codemirror.js"></script>
    <script src="scripts/inflection.js"></script>

    <link rel="stylesheet" href="styles/fancy/jquery.fancybox.css" type="text/css">
    <script src="scripts/jquery.fancybox.pack.js"></script>
    <script src="scripts/jquery.easing.1.3.js"></script>
    <script src="scripts/ui.js"></script>
</head>
<body>
    <div id="AppUI">
        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-inner">
                <div class="logo-container">
                    <a id="logo-jaystorm" class="brand" href="/">JayStorm Admin</a>
                </div>

                <div data-bind="if :authorization">
                    <form class="form-inline">
                        <label class="bold12 border-l-gray">Application Selector:</label>
                        <select data-bind="options: applications, 
                                                value: currentApplication, 
                                                optionsText: 'title',
                                                optionsCaption:'Select App To Manage'">
                        </select>

                        <div class="navbar sub-navbar iblock fright">
                            <a href="mailto:contact@jaystack.com?subject=JayStorm&#32;Admin&#32;Feedback" class="btn">Give us a feedback</a>
                        </div>

                        <div id="launchResult" data-bind="text:launchResult"></div>
                    </form>
                </div>
                <div data-bind="ifnot: authorization">
                    <form class="form-inline">
                        <p class="bold12">Collecting apps and getting authorization. Please wait...</p>
                    </form>
                </div>
            </div>
        </div>

        <div class="tabbable tabs-left main-tab">
            <div class="tabbable tabs-left tab-left-container">
                <h2 class="menu-title">App config</h2>
                <ul id="nav-1" class="nav nav-tabs tabs-left-hl" data-bind="visible: currentApplication, foreach:menuItems">
                    <li><a href="#" data-bind="visible: $root.navigationVisible, click: $root.show, text: title, attr: { id: $index, class: cssclass }"></a></li>
                </ul>

                <h2 class="menu-title">Tools</h2>
                <ul id="nav-2" class="nav nav-tabs tabs-left-hl" data-bind="visible: currentApplication, foreach: submenuItems">
                    <li><a href="#" data-bind="visible: $root.navigationVisible, click: $root.show, text: title, attr: { id: id, class: cssclass }"></a></li>
                </ul>
            </div>
            <div class="tab-content main-tab-content">
                <div class="tab-content-item tab-pane fade">
                    <div id="SchemaManagerUI" data-bind="if: visible">
                        <script type="text/html" id="customizeField">
                            <div>
                                <h4 style="display: inline">Customize field</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>
                                <form class="form-horizontal">
                                    <fieldset>
                                        <legend>Attributes</legend>
                                        <div class="control-group">
                                            <label class="control-label" for="inputName">Name</label>
                                            <div class="controls">
                                                <input type="text" id="inputName" data-bind="value: data.Name" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputType">Type</label>
                                            <div class="controls">
                                                <input type="text" id="inputType" data-bind="value: data.Type" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputElementType">Element type</label>
                                            <div class="controls">
                                                <input type="text" id="inputElementType" data-bind="value: data.ElementType" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputInverseProperty">Inverse property</label>
                                            <div class="controls">
                                                <input type="text" id="inputInverseProperty" data-bind="value: data.InverseProperty" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputTypeTemplate">Type template</label>
                                            <div class="controls">
                                                <select data-bind="options: parent.typeTemplates, optionsText: 'Name', optionsValue: 'Name',
                                                            value: data.TypeTemplate,
                                                            optionsCaption: data.TypeTemplate() ? undefined : 'Select'">
                                                </select>
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputKey">Key</label>
                                            <div class="controls">
                                                <input type="checkbox" id="inputKey" data-bind="checked: data.Key" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputComputed">Computed</label>
                                            <div class="controls">
                                                <input type="checkbox" id="inputComputed" data-bind="checked: data.Computed" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputNullable">Nullable</label>
                                            <div class="controls">
                                                <input type="checkbox" id="inputNullable" data-bind="checked: data.Nullable" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputLazyLoad">Lazy load</label>
                                            <div class="controls">
                                                <input type="checkbox" id="inputLazyLoad" data-bind="checked: data.LazyLoad" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputRequired">Required</label>
                                            <div class="controls">
                                                <input type="checkbox" id="inputRequired" data-bind="checked: data.Required" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputMinValue">Minimum value</label>
                                            <div class="controls">
                                                <input type="text" id="inputMinValue" data-bind="value: data.MinValue" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputMaxValue">Maximum value</label>
                                            <div class="controls">
                                                <input type="text" id="inputMaxValue" data-bind="value: data.MaxValue" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputMinLength">Minimum length</label>
                                            <div class="controls">
                                                <input type="text" id="inputMinLength" data-bind="value: data.MinLength" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputMaxLength">Maximum length</label>
                                            <div class="controls">
                                                <input type="text" id="inputMaxLength" data-bind="value: data.MaxLength" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputLength">Exact length</label>
                                            <div class="controls">
                                                <input type="text" id="inputLength" data-bind="value: data.Length" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputRegExp">Regular expression validator</label>
                                            <div class="controls">
                                                <input type="text" id="inputRegExp" data-bind="value: data.RegExp" />
                                            </div>
                                        </div>
                                        <div class="control-group">
                                            <label class="control-label" for="inputExtendedProperties">Extended properties</label>
                                            <div class="controls">
                                                <textarea id="inputExtendedProperties" data-bind="text: data.ExtendedProperties"></textarea>
                                            </div>
                                        </div>
                                    </fieldset>
                                </form>
                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>
                            </div>
                        </script>

                        <script type="text/html" id="insideEditor">
                            <div class="inner-table">
                                <h4 style="display: inline">Add or remove fields</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>
                                <div data-bind="with: selectedEntity">
                                    Table item name: <span data-bind="text: Name"></span>, Full JavaScript class name: <span data-bind="text: FullName"></span>
                                    <!--, EntityID: <span data-bind="text: EntityID"></span>-->
                                </div>
                                <div data-bind="jayGrid: {
                                                    source: $root.createContext().EntityFields,
                                                    beforeSave: beforeSaveField,
                                                    afterRevert: afterRevertHandler,
                                                    showSort: false, showRemoveAllCommand: false, showNewCommandTop: false,
                                                    discriminatorColumn:'EntityID',
                                                    afterAddNew: $root.afterAddNewEntityField,
                                                    typeTemplates: $root.typeTemplates,
                                                    elementTypes: $root.elementTypes,
                                                    defaultValues: { 'DatabaseID' : $root.currentDatabaseID },
                                                    discriminatorValue:$data.data.owner.ElementTypeID(),
                                                    fields:[{name: 'Index','$width':'25px', '$displayName':'#', '$editable':false}, 
                                                            { name: 'Name', 'hint': 'Field name'},
                                                            { name: 'TypeTemplate', $displayName: 'Type' },
                                                            { name: 'ElementType', $displayName: 'Element type' }, 'Required', 'Nullable',
                                                            { name: 'LazyLoad', $displayName: 'Lazy load' }]}">

                                    <div data-name-template="TypeTemplate-editor">
                                        <div data-bind="text: console.log($root)"></div>
                                        <select data-bind="options:$root.typeTemplates, optionsText:'Name', optionsValue: 'Name',
                                                            value: value,
                                                            optionsCaption: value() ? undefined : 'Select'">
                                        </select>
                                        <a href="#" data-bind="click: $data.showControls.bind({},'customizeField',FieldsCustomizeEditorModel, 
                                                                            { field: $data, parent: $root, factory: $root.contextFactory, currentDB: $root.currentDatabase })">Customize</a>
                                    </div>
                                    <div data-name-template="ElementType-editor">
                                        <div data-bind="if: owner.TypeTemplate() === 'Array'">
                                            <select data-bind="options:$root.elementTypes,
                                                        optionsText:'Name',
                                                        optionsValue: 'TypeName',
                                                        value: value,
                                                        optionsCaption: value() ? undefined :  'Select...'">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>
                            </div>
                        </script>

                        <script type="text/html" id="insideComplexTypeEditor">
                            <div class="inner-table">
                                <h4 style="display: inline">Add or remove fields</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>
                                <div data-bind="with: selectedEntity">
                                    Complex type name: <span data-bind="text: Name"></span>, Full JavaScript class name: <span data-bind="text: FullName"></span>
                                    <!--                                            , EntityID: <span data-bind="text: EntityID"></span>-->
                                </div>
                                <div data-bind="jayGrid: {
                                        source: $root.createContext().EntityFields,
                                        beforeSave: beforeSaveField,
                                        afterRevert: afterRevertHandler,
                                        showSort: false, showRemoveAllCommand: false, showNewCommandTop: false,
                                        discriminatorColumn:'EntityID',
                                        afterAddNew: $root.afterAddNewEntityField,
                                        typeTemplates: $root.typeTemplates,
                                        elementTypes: $root.elementTypes,
                                        defaultValues: { 'DatabaseID' : $root.currentDatabaseID },
                                        discriminatorValue:$data.data.owner.EntityID(),
                                        fields:[{name: 'Index','$width':'25px', '$displayName':'#', '$editable':false}, 
                                                { name: 'Name', 'hint': 'Field name'},
                                                { name: 'TypeTemplate', $displayName: 'Type' },
                                                { name: 'ElementType', $displayName: 'Element type' },'Required', 'Nullable']}">

                                    <div data-name-template="TypeTemplate-editor">
                                        <div data-bind="text: console.log($root)"></div>
                                        <select data-bind="options:$root.typeTemplates, optionsText:'Name', optionsValue: 'Name',
                                                value: value,
                                                optionsCaption: value() ? undefined : 'Select...'">
                                        </select>
                                        <a href="#" data-bind="click: $data.showControls.bind({},'customizeField',FieldsCustomizeEditorModel, 
                                                                { field: $data, parent: $root, factory: $root.contextFactory, currentDB: $root.currentDatabase })">Customize</a>
                                    </div>
                                    <div data-name-template="ElementType-editor">
                                        <div data-bind="if: owner.TypeTemplate() === 'Array'">
                                            <select data-bind="options:$root.elementTypes,
                                                    optionsText:'Name',
                                                    optionsValue: 'TypeName',
                                                    value: value,
                                                    optionsCaption: value() ? undefined :  'Select...'">
                                            </select>
                                        </div>
                                    </div>
                                </div>
                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>
                            </div>
                        </script>

                        <script type="text/html" id="eventHandlerCell">
                            <a href="#" data-bind="click: $data.showControls.bind({}, 'eventHandlerCodeEditor', EventHandlerCodeEditorModel, { eventHandler: $data })">Edit code
                            </a>
                        </script>

                        <script type="text/html" id="eventHandlerCodeEditor">
                            <span>Event handler source</span>
                            <!--                                    <a href="#" class="btn btn-danger" style="float:right" data-bind="click: closeControlBox">Close</a>-->
                            <div data-bind="attr: { id: 'handler-code-editor-' + ko.utils.unwrapObservable($data.data.rowIndex) }"></div>
                            <div data-bind="if: $data.error().length, attr: { id: 'handler-code-error-' + ko.utils.unwrapObservable($data.data.rowIndex) }">
                                <ul data-bind="foreach: $data.error">
                                    <li data-bind="if: $data">
                                        <span class="CodeMirror-error-pos" data-bind="text: 'line ' + $data.line + ' col ' + $data.character"></span>
                                        <span class="CodeMirror-error-reason" data-bind="text: $data.reason"></span>
                                        <pre class="CodeMirror-error-code" data-bind="text: $data.evidence"></pre>
                                    </li>
                                </ul>
                            </div>
                            <!--<a href="#" class="btn btn-success" style="float:right;" data-bind="click: saveHandler">Save</a>-->
                            <!--<a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>-->
                        </script>

                        <script type="text/html" id="eventHandlersEditor">
                            <div class="inner-table">
                                <h4 style="display: inline">Add or remove events</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>
                                <div data-bind="with: selectedEntitySet">
                                    Table item name: <span data-bind="text: Name"></span>, Full JavaScript class name: <span data-bind="text: console.log('fdfjkdshfjkdshkfhdskjhfkdshfhksdhfkjdhksja', $data)"></span>
                                </div>
                                <div data-bind="jayGrid: {
                                                    source: $root.createContext().EventHandlers,
                                                    beforeSave: beforeSaveHandler,
                                                    afterRevert: afterRevertHandler,
                                                    showSort: false, showRemoveAllCommand: false, showNewCommandTop: false,
                                                    defaultValues: { 'DatabaseID' : $root.currentDatabaseID },
                                                    discriminatorColumn: 'EntitySetID',
                                                    discriminatorValue: $data.data.owner.EntitySetID(),
                                                    fields:[{ name: 'Type', 'hint': 'Event type'}]}">

                                    <div data-name-template="Type-editor">
                                        <a href="#" style="display: none;" data-bind="text: setTimeout($data.showControls.bind({}, 'eventHandlerCodeEditor', EventHandlerCodeEditorModel, { eventHandler: $data, parent: $root }), 0)">Edit code
                                        </a>
                                        <select data-bind="options: $root.eventTypes,
                                                        optionsText: 'name',
                                                        optionsValue: 'type',
                                                        value: value,
                                                        optionsCaption: value() ? undefined :  'Select...'">
                                        </select>
                                    </div>

                                    <!--                                                <div data-name-template="Handler-display">-->
                                    <!--                                                    <div style="max-height:1.5em;">-->
                                    <!--                                                        <pre style="font-size:0.5em;line-height:1em;" data-bind="text: value">-->
                                    <!--                                                        </pre>-->
                                    <!--                                                    </div>-->
                                    <!--                                                </div>-->
                                    <!--                                                -->
                                    <!--                                                <div data-name-template="Handler-editor">-->
                                    <!--                                                    <a href="#" style="display:none;" data-bind="text: $data.showControls.bind({}, 'eventHandlerCodeEditor', EventHandlerCodeEditorModel, { eventHandler: $data })()">-->
                                    <!--                                                        Edit code-->
                                    <!--                                                    </a>-->
                                    <!--                                                </div>-->
                                </div>
                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>

                            </div>
                        </script>

                        <script type="text/html" id="indexKeysEditor">
                            <div>
                                <h4 style="display: inline">Add or remove index keys</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>
                                <span data-bind="text: console.log($data, $root)"></span>
                                <div data-bind="jayGrid: {
                                            source: $root.root().createContext().IndexKeys,
                                            beforeSave: beforeSaveField,
                                            discriminatorColumn: 'IndexID',
                                            discriminatorValue: selectedIndex().IndexID(),
                                            defaultValues: { 'DatabaseID' : currentDatabaseID(), IndexID: selectedIndex().IndexID() },
                                            showSort: false, showNewCommandTop: false,
                                            fields: [
                                                { name: 'EntityFieldID', $displayName: 'Entity field' },
                                                { name: 'Order', $displayName: 'Index ordering' },
                                                { name: 'Spatial', $displayName: 'Geospatial index' }
                                            ]
                                        }">

                                    <div data-name-template="EntityFieldID-display">
                                        <span data-bind="text: ($root.entityFields().filter(function(it){ return it.EntityFieldID() == value(); })[0] || { Name: '' }).Name"></span>
                                    </div>

                                    <div data-name-template="EntityFieldID-editor">
                                        <select data-bind="options: $root.entityFields(),
                                                optionsValue: 'EntityFieldID', optionsText: 'Name', value: $parent[name],
                                                optionsCaption: 'Select...',
                                                optionsCaptionValue: null">
                                        </select>
                                    </div>
                                </div>

                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>

                            </div>
                        </script>

                        <script type="text/html" id="indexKeysCell">
                            <div data-bind="ifnot: owner.IndexID()">
                                Save index to edit keys
                            </div>
                            <div data-bind="if: owner.IndexID()">
                                <a href="#" data-bind="click: $data.showControls.bind({},'indexKeysEditor',IndexKeysEditorModel, 
                                                                    { index: $data, entity: $root.selectedEntity(), factory: $root.root().contextFactory, currentDB: $root.root().currentDatabase })">Manage keys
                         
                                </a>
                            </div>
                        </script>

                        <script type="text/html" id="indicesEditor">
                            <div class="inner-table">
                                <h4 style="display: inline">Add or remove indices</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>
                                <div data-bind="with: selectedEntitySet">
                                    Table item name: <span data-bind="text: Name"></span>
                                </div>

                                <div data-bind="jayGrid: {
                                            source: $root.createContext().Indices,
                                            beforeSave: beforeSaveField,
                                            discriminatorColumn: 'EntitySetID',
                                            discriminatorValue: selectedEntitySet().EntitySetID(),
                                            defaultValues: { 'DatabaseID' : $root.currentDatabaseID(), EntitySetID: $data.selectedEntitySet().EntitySetID() },
                                            showSort: false, showNewCommandTop: false,
                                            fields: [
                                                { name: 'Name', type: 'string', $displayName: 'Index name' },
                                                { name: 'Index keys', isVirtual: true, type: 'string', '$width':'200px', '$template': 'indexKeysCell'},
                                                { name: 'Unique', $displayName: 'Is unique' },
                                                { name: 'ExpireAfterSeconds', type: 'number', $displayName: 'TTL (in seconds)' }
                                            ]
                                        }">
                                </div>

                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>

                            </div>
                        </script>

                        <script type="text/html" id="editFieldsCell">
                            <div>
                                <!--                                        <div data-bind="ifnot: owner.EntitySetID()">
                                            Save table to edit fields
                                        </div>-->
                                <div data-bind="if: owner.EntitySetID()">
                                    <a href="#" data-bind="click: $data.showControls.bind({},'insideEditor',FieldsEditorModel, 
                                                                            { entitySet : $data, factory: $root.contextFactory, currentDB: $root.currentDatabase })">Manage fields
                                    </a>
                                    <br>
                                    <a href="#" data-bind="click: $data.showControls.bind({},'eventHandlersEditor', EventHandlersEditorModel, 
                                                                            { entitySet : $data, factory: $root.contextFactory, currentDB: $root.currentDatabase })">Manage events
                                    </a>
                                    <br>
                                    <!-- ko if: $root.indicesNotSupported -->
                                    <a href="#" data-bind="click: $data.showControls.bind({},'indicesEditor', IndicesEditorModel, 
                                                                    { entitySet : $data, root: $root, factory: $root.contextFactory, currentDB: $root.currentDatabase })">Manage indices
                                    </a>
                                    <br>
                                    <!-- /ko -->
                                    <a href="#" data-bind="click: $root.editData">Edit data
                                    </a>
                                </div>
                                <div data-bind="if: owner.HasChanges()">(unpublished changes)</div>

                            </div>

                        </script>

                        <script type="text/html" id="editComplexTypeCell">
                            <div>
                                <div data-bind="if: owner.EntityID()">
                                    <a href="#" data-bind="click: $data.showControls.bind({},'insideComplexTypeEditor',ComplexTypeEditorModel, 
                                                                    { entitySet : $data, entity: $data.owner, factory: $root.contextFactory, currentDB: $root.currentDatabase })">Manage fields
                             
                                    </a>
                                </div>
                                <div data-bind="if: owner.HasChanges()">(unpublished changes)</div>

                            </div>

                        </script>

                        <!--ko if: adminApiClient.publishSuccess() == 0-->
                        <div class="thumbnails small">
                            <div class="wrapper-mini">
                                <ul>
                                    <li class="thumbnail active">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2>1</h2>
                                        </div>
                                        <h3>Define DB</h3>
                                    </li>
                                    <li class="thumbnail" onclick="slideclick(event, this);" id="1">
                                        <div class="box box-mini box-circle box-gray">
                                            <h2>2</h2>
                                        </div>
                                        <h3>Create logic</h3>
                                    </li>
                                    <li class="thumbnail" onclick="slideclick(event, this);" id="7">
                                        <div class="box box-mini box-circle box-gray">
                                            <h2>3</h2>
                                        </div>
                                        <h3>Publish API</h3>
                                    </li>
                                    <li class="thumbnail" onclick="slideclick(event, this);" id="9">
                                        <div class="box box-mini box-circle box-gray">
                                            <h2>4</h2>
                                        </div>
                                        <h3>API Access</h3>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--/ko-->

                        <h1>Manage Database Schemas</h1>
                        <div data-bind="attr: { class: adminApiClient.publishSuccess() == 0 ? 'alert alert-info fade in clear margint50' : 'alert alert-info fade in clear' }">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>If your application needs to store data, create tables and fields to describe it's shape. You'll be rewarded with an out of the box REST data API with query and CRUD capabilities.</p>
                        </div>

                        <div class="alert alert-danger fade in" style="float: none; display: inline-block;" data-bind="visible: !indicesNotSupported()">
                            <p><strong>Attention!</strong> You use an older version of JayStorm. Please publish your application to use indices in your schema.</p>
                        </div>

                        <h4>Select database schema to edit:</h4>
                        <!--                                <select data-bind="options: databases, optionsCaption: 'Select database',
                                                    optionsText: 'Name',
                                                    value: $root.currentDatabase"></select>-->

                        <ul class="nav nav-tabs" data-bind="foreach:databases">
                            <li><a href="#" data-bind="text:Name,click: $root.currentDatabase.bind($data), attr: { 'data-dbname': Name }"></a></li>
                        </ul>

                        <div data-bind="if: currentDatabase">
                            <!-- ko if: currentDatabase().HasChanges -->
                            <div class="alert alert-danger" style="float: none;">
                                <button type="button" class="close" data-dismiss="alert">&#120;</button>
                                <p><strong>Attention!</strong> This database schema has changed. You need to publish these changes before they take effect.</p>
                            </div>
                            <!-- /ko -->

                            <!--<h5 class="muted">Selected database schema: <span class="jayblue" data-bind="text: currentDatabase().Name"></span></h5>-->
                            <div data-bind="if: IsApplicationDB">
                                <div class="alert alert-danger fright iblock" style="float: none;">
                                    <button type="button" class="close" data-dismiss="alert">&#120;</button>
                                    <p><strong>Attention!</strong> The ApplicationDB contains all the meta information about your JayStorm JavaScript application and in trained hands is a powerful tool to create ultra dynamic and flexible data applications. Used on the wrong way however can easily render your system unoperational!</p>
                                </div>
                            </div>

                            <div class="tabbable">
                                <ul class="nav nav-tabs reset-m">
                                    <li class="active"><a data-toggle="tab" data-bind="attr: { href: '#' + $root.currentDatabase().Name() + '-tables' }">Tables</a></li>
                                    <li><a data-toggle="tab" data-bind="attr: { href: '#' + $root.currentDatabase().Name() + '-complextypes' }">Complex types</a></li>
                                </ul>
                                <div class="tab-content">
                                    <div class="tab-pane active" data-bind="attr: { id: $root.currentDatabase().Name() + '-tables' }">
                                        <h3 class="clear">List of tables</h3>
                                        <!-- ko if:tableItemsPresent() && (tableItems().length == 0) -->
                                        <div class="alert alert-warning">
                                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                                            <p><strong>Attention!</strong> This database does not have any tables yet. Create a new table to add fields, server event handlers and indices</p>
                                        </div>
                                        <!-- /ko -->

                                        <div data-bind="jayGrid: {
                                                    newCommandCaption: 'Create new table',
                                                    items: tableItems,
                                                    showRemoveAllCommand: false,
                                                    itemsReceived: tableListReceived,
                                                    source: context().EntitySets,
                                                    fields: [{name: 'Name', '$width':'200px', 'hint':'Tablename', '$displayName': 'Table name'}, 
                                                             { name: 'Table fields', isVirtual: true, type:'string', '$width':'200px', '$template':'editFieldsCell'}, 
                                                            'Published'],
                                                    discriminatorColumn: 'DatabaseID',
                                                    beforeSave: beforeDatabaseSave,
                                                    discriminatorValue: currentDatabaseID,
                                                    pageSize: eSetsPageSize },
                                                    visible: currentDatabase">

                                            <script type="text/html" data-name-template="Name-display">
                                                <h5 data-bind="text: value"></h5>
                                            </script>
                                        </div>
                                    </div>
                                    <div class="tab-pane" data-bind="attr: { id: $root.currentDatabase().Name() + '-complextypes' }">
                                        <h3 class="clear">List of complex types</h3>
                                        <!-- ko if:complexTypesPresent() && (complexTypes().length == 0) -->
                                        <div class="alert alert-warning">
                                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                                            <p><strong>Attention!</strong> This database does not have any complex types yet. Create a new complex type to use as a type of a table field</p>
                                        </div>
                                        <!-- /ko -->

                                        <div data-bind="jayGrid: {
                                                    newCommandCaption: 'Create new complex type',
                                                    items: complexTypes,
                                                    showRemoveAllCommand: false,
                                                    itemsReceived: complexTypesReceived,
                                                    source: context().ComplexTypes,
                                                    fields: [{name: 'Name', '$width':'200px', 'hint':'Complex type', '$displayName': 'Complex type'}, 
                                                             { name: 'Table fields', isVirtual: true, type:'string', '$width':'200px', '$template':'editComplexTypeCell'}],
                                                    discriminatorColumn: 'DatabaseID',
                                                    discriminatorValue: currentDatabaseID,
                                                    beforeSave: beforeComplexTypeSave,
                                                    pageSize: eSetsPageSize },
                                                    visible: currentDatabase">

                                            <script type="text/html" data-name-template="Name-display">
                                                <h5 data-bind="text: value"></h5>
                                            </script>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="ServiceManagerUI" data-bind="if: visible">

                        <!--ko if: adminApiClient.publishSuccess() == 0-->
                        <div class="thumbnails small">
                            <div class="wrapper-mini">
                                <ul>
                                    <li class="thumbnail active" onclick="slideclick(event, this);" id="0">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2><i class="icon-ok icon-white"></i></h2>
                                        </div>
                                        <h3>Define DB</h3>
                                    </li>
                                    <li class="thumbnail active">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2>2</h2>
                                        </div>
                                        <h3>Create logic</h3>
                                    </li>
                                    <li class="thumbnail" onclick="slideclick(event, this);" id="7">
                                        <div class="box box-mini box-circle box-gray">
                                            <h2>3</h2>
                                        </div>
                                        <h3>Publish API</h3>
                                    </li>
                                    <li class="thumbnail" onclick="slideclick(event, this);" id="9">
                                        <div class="box box-mini box-circle box-gray">
                                            <h2>4</h2>
                                        </div>
                                        <h3>API Access</h3>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--/ko-->

                        <h1>Manage Services</h1>
                        <div data-bind="attr: { class: adminApiClient.publishSuccess() == 0 ? 'alert alert-info fade in clear margint50' : 'alert alert-info fade in clear' }">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>
                                You can manage your application services here, that is the data endpoint of your app.
                                        <br />
                                You can crearte two types of services:
                                <ul>
                                    <li>JavaScript API service - you can add the services of your choices to the oData endpoint, using your JavaScript code
                                    </li>
                                    <li>JavaScript Data service - you can publish the selected database and you have the option to add further services to the oData endpoint
                                    </li>
                                </ul>
                            </p>
                        </div>

                        <div class="alert alert-danger fade in" style="float: none; display: inline-block;" data-bind="visible: !serviceOperationsNotSupported()">
                            <p><strong>Attention!</strong> You use an older version of JayStorm. Please publish your application to build service operations in your service.</p>
                        </div>

                        <script type="text/html" id="serviceOperationCodeEditor">
                            <span>Service operation source</span>
                            <!--                                    <a href="#" class="btn btn-danger" style="float:right" data-bind="click: closeControlBox">Close</a>-->
                            <div data-bind="attr: { id: 'serviceoperation-code-editor-' + ko.utils.unwrapObservable($data.data.rowIndex) }"></div>
                            <div data-bind="if: $data.error().length, attr: { id: 'serviceoperation-code-error-' + ko.utils.unwrapObservable($data.data.rowIndex) }">
                                <ul data-bind="foreach: $data.error">
                                    <li data-bind="if: $data">
                                        <span class="CodeMirror-error-pos" data-bind="text: 'line ' + $data.line + ' col ' + $data.character"></span>
                                        <span class="CodeMirror-error-reason" data-bind="text: $data.reason"></span>
                                        <pre class="CodeMirror-error-code" data-bind="text: $data.evidence"></pre>
                                    </li>
                                </ul>
                            </div>
                            <!--<a href="#" class="btn btn-success" style="float:right;" data-bind="click: saveHandler">Save</a>-->
                            <!--<a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>-->
                        </script>

                        <script id="serviceOperationsEditor" type="text/html">
                            <div>
                                <h4 style="display: inline">Add or remove service operations</h4>
                                <a href="#" class="btn btn-danger" style="float: right" data-bind="click: closeControlBox">Close</a>

                                <div data-bind="jayGrid: {
                                                    source: $root.createContext().ServiceOperations,
                                                    beforeSave: beforeSaveHandler,
                                                    afterRevert: afterRevertHandler,
                                                    showSort: false, showRemoveAllCommand: false, showNewCommandTop: false,
                                                    defaultValues: { 'ServiceID' : $data.data.owner.ServiceID(), 'FunctionBody': new EJS({ url: '/scripts/serviceoperation-template.ejs' }).render({ name: '' }) },
                                                    discriminatorColumn: 'ServiceID',
                                                    discriminatorValue: $data.data.owner.ServiceID(),
                                                    fields:[{ name: 'Name', 'hint': 'Service operation name'}]}">

                                    <div data-name-template="Name-editor">
                                        <input type="text" data-bind="value: value, attr: { required: metadata.required, pattern: metadata.$RegExp ? metadata.$RegExp.slice(1, -1) : null }, css: { verror: owner.ValidationErrors }" />
                                        <a href="#" style="display: none;" data-bind="text: setTimeout($data.showControls.bind({}, 'serviceOperationCodeEditor', ServiceOperationCodeEditorModel, { service: $data, serviceOperation: $data, parent: $root }), 0)">Edit code
                                        </a>
                                    </div>
                                </div>
                                <a href="#" class="btn btn-info" data-bind="click: buildServiceSource">Build</a>
                                <a href="#" class="btn btn-danger" data-bind="click: closeControlBox">Close</a>
                            </div>
                        </script>

                        <div id="svcGrid" data-bind="jayGrid: { source: context().Services,
                                                        context: context,
                                                        fields: [
                                                            {name:'Name', $width:'300px'},
                                                            {name: 'ServiceType', $width:'200px'},
                                                            {name: 'DatabaseID', $displayName: 'Backing database', $width:'300px'},
                                                            'ServiceSource'
                                                        ],
                                                        defaultValues: { 'ServiceSourceType': 'script'},
                                                        beforeSave: function(){ $root.editingSource(false); },
                                                        allDatabases: allDatabases,
                                                        showRemoveAllCommand: false,
                                                        databaseSet: context().Databases}">

                            <!--, dbs: databases, databases: context().Databases-->
                            <!--currentApplication-->
                            <script type="text/html" data-name-template="Name-display">
                                <b><a data-bind="{text: value, attr: { target: '_blank', href: $root.application.currentApplication().url + value() } }"></a></b>
                                <div data-bind="if: owner.HasChanges()">(unpublished changes)</div>
                                <a href="#" data-bind="click: $data.showControls.bind({},'embedService',EmbedServiceModel, { service : $data, factory: $root.contextFactory })">API access tutorials</a>

                                <!--<a data-bind="{text: $root.application.currentApplication().url + '/' + value() }}"></a>-->
                            </script>
                            <script type="text/html" data-name-template="ServiceType-editor">
                                <select data-bind="options: ['JavaScript Data Service','JavaScript API Service'], value: value"></select>
                            </script>

                            <script type="text/html" data-name-template="ServiceType-display">
                                <div data-bind="text: value() ? value() : 'JavaScript Data Service'"></div>
                            </script>

                            <script type="text/html" data-name-template="DatabaseID-editor">
                                <div data-bind='if: owner.ServiceType() !== "JavaScript API Service"'>
                                    <a href='#' class='btn' data-bind='click: function(){ value(null); }'>Clear</a>
                                    <select data-bind="options: $root.allDatabases,
                                        optionsValue: 'DatabaseID', optionsText: 'Name', value: $parent[name],
                                        optionsCaption: 'Select...',
                                        optionsCaptionValue: null">
                                    </select>
                                </div>
                            </script>

                            <script type="text/html" data-name-template="DatabaseID-display">
                                <span data-bind="readValue: { source: $root.databaseSet, key: $parent[name], field: 'Name' }"></span>
                                <div>
                                    <a href="#" data-bind="if: value, click: $root.editData">Edit data</a>
                                </div>
                            </script>

                            <script type="text/html" data-name-template="Sets-editor">
                                <a href="#" data-bind="click: $root.selectService.bind({}, $parent)">#</a>
                            </script>

                            <script type="text/html" data-name-template="ServiceSourceType-editor">
                                <select data-bind="options: $root.serviceSourceTypes,
                                    optionsValue: 'type', optionsText: 'name', value: value,
                                    optionsCaption: 'Select...' ">
                                </select>
                            </script>

                            <script type="text/html" data-name-template="ServiceSourceType-display">
                                <span data-bind="text: ($root.serviceSourceTypes().filter(function(it){ return it.type == value() })[0] || { name: '-' }).name"></span>
                            </script>

                            <script type="text/html" data-name-template="ServiceSource-editor">
                                <!--<a href='#' class='btn' data-bind='visible: !!$data.ServiceID, click: function(){ $root.editSource(owner, value, $root.error); }, visible: owner.ServiceSourceType() == "script"'>Edit Source</a>-->
                            </script>

                            <script type="text/html" data-name-template="ServiceSource-display">
                                <!--<pre data-bind="visible: owner.ServiceSourceType() == 'script' && value(), attr: { id: 'Service-' + ko.utils.unwrapObservable(rowIndex), codemirror: (function(){ if (value()) $root.codeHighlight('Service-' + ko.utils.unwrapObservable(rowIndex), value); })() }"></pre>-->
                                <div><a href='#' data-bind='visible: !$data.ServiceID, click: function(){ $root.editSource(owner, value, $root.error); }, visible: owner.ServiceSourceType() == "script"'>Edit source</a></div>
                                <div data-bind="if: $root.serviceOperationsNotSupported">
                                    <a href='#' data-bind='visible: !$data.ServiceID, click: $data.showControls.bind({}, "serviceOperationsEditor", ServiceOperationsEditorModel, 
                                                                            { service: $data, factory: $root.contextFactory }), visible: owner.ServiceSourceType() == "script"'>Edit service operations</a>
                                </div>
                            </script>
                        </div>

                        <div data-bind="if: editingSource">
                            <h2>Edit source</h2>

                            <div id="service-codemirror"></div>
                            <div id="Div1" data-bind="if: error().length">
                                <ul data-bind="foreach: error">
                                    <li data-bind="if: $data">
                                        <span class="CodeMirror-error-pos" data-bind="text: 'line ' + $data.line + ' col ' + $data.character"></span>
                                        <span class="CodeMirror-error-reason" data-bind="text: $data.reason"></span>
                                        <pre class="CodeMirror-error-code" data-bind="text: $data.evidence"></pre>
                                    </li>
                                </ul>
                            </div>
                        </div>

                        <div data-bind="if: selectedService">
                            <div id="entitySets" data-bind="jayGrid: {
                                                            source: context().EntitySetPublications,
                                                            context: context,
                                                            fields: 'EntitySetID'
                                                            discriminatorColumn: 'ServiceID',
                                                            discriminatorValue: selectedService().ServiceID,
                                                            allDatabases: allDatabases,
                                                            databaseSet: context().Databases}">

                                <script type="text/html" data-name-template="Publish-display">
                                    <span data-bind="text: $root.checkBoxStates().length"></span>
                                    <input type="checkbox" data-bind="click: $root.check, checked: $root.checkBoxStates().length < 1" />
                                </script>

                                <!--, dbs: databases, databases: context().Databases-->
                                <script type="text/html" data-name-template="DatabaseID-editor">
                                    <select data-bind="options: $root.allDatabases,
                                        optionsValue: 'DatabaseID', optionsText: 'Name', value: $parent[name],
                                        optionsCaption: 'Select...' ">
                                    </select>
                                </script>

                                <script type="text/html" data-name-template="DatabaseID-display">
                                    <span data-bind="text: $parent[name]"></span>:<span data-bind="readValue: { source: $root.databaseSet, key: $parent[name], field: 'Name' }"></span>
                                </script>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="SecurityManagerUI" data-bind="if: visible && context">
                        <h1>Manage Security</h1>
                        <div class="alert alert-info fade in">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>
                                You can assign permissions to security groups for each database table.
                                        <br />
                                You can manage permissions for the following actions: Read, Delete, Update, Create, Delete in a batch, Manage. Manage permissions actions provide security empowering.
                            </p>
                        </div>

                        <h4>Add new permission</h4>
                        <form class="form-inline" data-bind="submit: addPermission">
                            <select class="input-medium" data-bind="options: databases, optionsText:'Name', value: selectedDatabase, optionsCaption:'All databases'"></select>
                            <select class="input-medium" data-bind="options: tables, optionsText:'Name',  value: selectedTable, optionsCaption:'All tables'"></select>
                            <select class="input-medium" data-bind="options: groups, optionsText:'Name',  value: selectedGroup, optionsCaption:'All groups'"></select>

                            <span class="iblock actions" data-bind="foreach: tablePermissions">
                                <span class="label-group">
                                    <input class="checkbox" type="checkbox" data-bind="checked: value, attr: { id: name }" />
                                    <label class="label-check" data-bind="text: name, attr: { for: name }"></label>
                                </span>
                            </span>

                            <input class="btn btn-info" type="submit" value="Add permission" />
                        </form>

                        <h4>List of active permissions</h4>

                        <div data-bind="jayGrid: {source: context().Permissions,
                                                showNewCommandBottom: false,
                                                showNewCommandTop: false,
                                               fields: ['DatabaseID', 'EntitySetID','GroupID','Read','Create','Update','Delete','DeleteBatch'],
                                              refresher: $root.rf }">

                            <script type="text/html" data-name-template="DatabaseID-display">
                                <span data-bind="readValue: { source: $root.context().Databases, key: value, field: 'Name' }"></span>
                            </script>
                            <script type="text/html" data-name-template="EntitySetID-display">
                                <span data-bind="readValue: { source: $root.context().EntitySets, key: value, field: 'Name' }"></span>
                            </script>
                            <script type="text/html" data-name-template="GroupID-display">
                                <span data-bind="readValue: { source: $root.context().Groups, key: value, field: 'Name' }"></span>
                            </script>
                            <script type="text/html" data-name-template="DatabaseID-editor">
                                <span data-bind="readValue: { source: $root.context().Databases, key: value, field: 'Name' }"></span>
                            </script>
                            <script type="text/html" data-name-template="EntitySetID-editor">
                                <span data-bind="readValue: { source: $root.context().EntitySets, key: value, field: 'Name' }"></span>
                            </script>
                            <script type="text/html" data-name-template="GroupID-editor">
                                <span data-bind="readValue: { source: $root.context().Groups, key: value, field: 'Name' }"></span>
                            </script>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="AccessManagerUI" data-bind="if: visible && context">
                        <h1>Access control</h1>

                        <div class="alert alert-danger" style="float: none;" data-bind="visible: isfreeapp">
                            <p><strong>Attention!</strong> This is a JayStorm Open application. Your access settings will not be deployed and have no effects.</p>
                            <p>To use these settings create a JayStorm Business application on <a href="https://dashboard.jaystack.com" target="_blank">https://dashboard.jaystack.com</a>.</p>
                        </div>

                        <div class="alert alert-info fade in">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>Ingress securitiy - you can define here your application access rule. You can define custom request headers to avoid cross-origin issues. Publish or unpublish your service endpoints and control rules (whether or not it is published as well as access control).</p>
                        </div>

                        <h4>Control who can access your system</h4>
                        <h4>Application Rules</h4>
                        <div data-bind="jayGrid: { fields: [ { name: 'Index', '$width':'40px' },
                                                     { name: 'RuleType', '$options':['Allow','Deny'] },
                                                     'SourceAddress','Port', 'PortEnd'], 
                                                     defaultValues: { Index : function() { return this.items().length; } },
                                                     filter: 'it.ObjectID == null',
                                                     beforeSave: beforeSave,
                                                     source: context().IngressIPRules }">
                        </div>
                        <div data-bind="jayGrid: { fields: ['SourceOrigin'],filter: 'it.ObjectID == null',
                                        beforeSave: beforeSave,
                                        source: context().IngressOriginRules }">
                        </div>
                        <h4>Default service rules</h4>
                        <div id="svcAccessGrid" data-bind="jayGrid: { showNewCommand: false, showRemoveAllCommand: false,
                                fields: ['Name','Published', 'AllowAnonymous','AllowAllIPs','AllowAllOrigins','UseDefaultPort','UseSSL'],
                                showNewCommandBottom: false,
                                showNewCommandTop: false,
                                deleteCommand: false,
                                beforeSave: beforeSave,
                                source: context().Services }">
                        </div>

                        <h4>Addition service rules</h4>
                        <div id="ingressIP" data-bind="jayGrid: { fields: ['Name', 'ObjectID','Port','SSL'], 
                                                source: context().IngressIPRules, filter: 'it.ObjectID != null',
                                                beforeSave: beforeSave,
                                                defaultValues: { 'SourceAddress': '*'}, }">

                            <script type="text/html" data-name-template="ObjectID-editor">
                                <select data-bind="options: $root.context().Services.toKoArray(), value: value, 
                                            optionsText:'Name', optionsValue:'ServiceID' ">
                                </select>
                            </script>
                            <script type="text/html" data-name-template="ObjectID-display">
                                <span data-bind="readValue: { source: $root.context().Services, key: value, field: 'Name' }"></span>
                            </script>

                            <script type="text/html" data-name-template="Port-editor">
                                <input type='number' data-bind='value: Model.Value, attr: { required: metadata.required }, css: { verror: owner.ValidationErrors }' />

                                <br />

                                <div class="validation-msg" data-bind="visible: Model.Value() < 1024">
                                    <p class="first">Invalid rule</p>
                                    <p class="second">Please specify ports above 1024!</p>
                                </div>
                            </script>
                            <script type="text/html" data-name-template="Port-display">
                                <span data-bind='text: value'></span>
                                <br />
                                <div class="validation-msg" data-bind="visible: Model.Value() < 1024">
                                    <p class="first">Invalid rule</p>
                                    <p class="second">Please specify ports above 1024!</p>
                                </div>
                            </script>
                        </div>
                        <div id="ingressOrigin" data-bind="jayGrid: { fields: ['Name', 'ObjectID', 'SourceOrigin'], 
                                                beforeSave: beforeSave,
                                                source: context().IngressOriginRules, filter: 'it.ObjectID != null' }">

                            <script type="text/html" data-name-template="ObjectID-editor">
                                <select data-bind="options: $root.context().Services.toKoArray(), value: value, 
                                            optionsText:'Name', optionsValue:'ServiceID' ">
                                </select>
                            </script>
                            <script type="text/html" data-name-template="ObjectID-display">
                                <span data-bind="readValue: { source: $root.context().Services, key: value, field: 'Name' }"></span>
                            </script>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="PackageManagerUI" data-bind="if: visible">
                        <h1>Manage NPM packages</h1>

                        <div class="alert alert-info fade in">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>
                                Here you can manage the NPM packages you want to install into your application.<br>
                                Packages will be deployed on publish.
                            </p>
                        </div>

                        <br>

                        <div class="alert alert-danger fade in" style="float: none; display: inline-block;" data-bind="visible: notsupported">
                            <p><strong>Attention!</strong> You use an older version of JayStorm. Please publish your application to use the Package Manager.</p>
                        </div>

                        <script type="text/html" id="packageStatus">
                            <i data-bind="css: (value() == null || value() == 'pending') ? 'icon-time' : (value() == 'installed' ? 'icon-ok' : 'icon-ban-circle')"></i>
                            <span data-bind="text: value() != null ? value().charAt(0).toUpperCase() + value().slice(1).toLowerCase() : 'Waiting for deployment'"></span>
                            <pre style="overflow: auto; text-align: left;" data-bind="visible: value() == 'error', text: owner.StdErr()"></pre>
                        </script>

                        <div data-bind="jayGrid: { source: context().Packages, fields: [
                            { name: 'Name', $displayName: 'NPM package name' },
                            { name: 'Status', isVirtual: true, type:'string', '$width':'400px', '$template':'packageStatus' }
                            ] }">
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="StaticFileUI" data-bind="if: visible">
                        <h1>Manage static files</h1>

                        <!--ko if: isfreeapp-->
                        <div class="alert alert-danger" style="float: none;" data-bind="if: isfreeapp">
                            <p><strong>Attention!</strong> This is a JayStorm Open application. Your file upload will fail.</p>
                            <p>To use static files create a JayStorm Business application on <a href="https://dashboard.jaystack.com" target="_blank">https://dashboard.jaystack.com</a>.</p>
                        </div>
                        <!--/ko-->

                        <div class="alert alert-info fade in">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>
                                Here you can upload all static files and JavaScript resources to the file repository. You can find this useful when developing your hybrid mobile application or web application as well.
                                        <br />
                                <b>Use drag and drop!</b> Drag the zip to the window to start download. We will deploy all files within your zip onto your dedicated virtual server. Upload all resources in one instance! You can empty your repository by clicking the Clear all button.
                            </p>
                        </div>

                        <div class="part">
                            <h4 class="subtitle">Static file upload (zip) </h4>
                            <form id="deletefile1" action="removeFile" action="post">
                                <input type="hidden" value="1" />
                                <input type="button" data-bind="click:removeStaticFiles" value="Clear all files" class="btn btn-danger" />
                            </form>
                            <form id="fileUpload1" action="fileUpload" action="post">
                                <div id="file-uploader1">
                                    <noscript>
                                        <p>Please enable JavaScript to use file uploader.</p>
                                        <!-- or put a simple form for upload here -->
                                    </noscript>
                                </div>
                                <div class="qq-upload-extra-drop-area1 btn btn-danger">Drop files here too</div>
                            </form>
                        </div>
                        <!--<div  class="part">
                                    <h4 class="subtitle">Javascript upload (zip) </h4>
                                    <form id="deletefile2" action="removeFile" action="post">
                                        <input type="hidden" value="2"/>
                                        <input type="button" data-bind="click:removeJsFiles" value="Clear all files" class="btn btn-danger"/>
                                    </form>
                                    <form id="fileUpload2" action="fileUpload" action="post">

                                        <div id="file-uploader2">
                                            <noscript>
                                                <p>Please enable JavaScript to use file uploader.</p>-->
                        <!-- or put a simple form for upload here -->
                        <!--              </noscript>
                                        </div>
                                        <div class="qq-upload-extra-drop-area2 btn btn-info">Drop files here too</div>
                                    </form>
                                </div>-->
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="UserManagerUI" data-bind="if: visible">
                        <script type="text/html" id="GroupArrayEditor">
                            <div>
                                <ul class="resetlist" data-bind="foreach: Groups">
                                    <li>
                                        <input type="checkbox" data-bind="checked: selected, attr: { id: Name }" />
                                        <label data-bind="text: Name, attr: { for: Name }"></label>
                                    </li>
                                </ul>
                                <a href="#" data-bind="click: closeControlBox">close</a>
                            </div>
                        </script>

                        <script type="text/html" id="setPasswordUI">
                            <form data-bind="submit: savePassword">
                                <div class="fields">
                                    <label>
                                        Password:
                                            <br />
                                        <input type="password" required data-bind="value: password" />
                                    </label>
                                    <br />
                                    <label>
                                        Retype:
                                            <br />
                                        <input type="password" required data-bind="value: rePassword" />
                                    </label>
                                    <br />
                                    <span class="alert-danger" data-bind="text: validation"></span>
                                </div>
                                <input class="btn btn-info" type="submit" />
                            </form>
                            <a href="#" data-bind="click: close">close</a>
                        </script>

                        <!--<div class="alert alert-danger fright iblock">
                                <button type="button" class="close" data-dismiss="alert">&#120;</button>
                                <p><strong>Attention!</strong> Refresh the page to see the changes!</p>
                            </div>-->
                        <h1>Manage Users</h1>
                        <div class="alert alert-info fade in">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>Here you can create users or user groups for your application as well as assign users to groups, reset user passwords and disable users.</p>
                        </div>

                        <div data-bind="if: Users">
                            <h4>Manage users</h4>

                            <div data-bind="jayGrid: { source: Users, itemExtender: extendUserItem,
                                                fields: ['Login', 'FirstName','LastName','Password','Groups'] }">

                                <script type="text/html" data-name-template="Password-display">
                                    ******
                                </script>
                                <script type="text/html" data-name-template="Password-editor">
                                    <a href="#" data-bind="click: $data.showControls.bind({}, 'setPasswordUI', SetPasswordModel, { user: owner, app: $data, root: $root })">Reset password</a>
                                </script>

                                <script type="text/html" data-name-template="Groups-editor">
                                    <div data-bind="foreach: value">
                                        <span data-bind="readValue: { source: $root.context().Groups, key: $data, field: 'Name' }"></span>
                                    </div>
                                    <a href="#"
                                        data-bind="click: $data.showControls.bind({},'GroupArrayEditor', 
                                GroupEditor, { meta: $data, entity: owner, value: value, context: $root.context })">Click me!</a>
                                </script>

                                <script type="text/html" data-name-template="Groups-display">
                                    <div data-bind="foreach: value">
                                        <span data-bind="readValue: { source: $root.context().Groups, key: $data, field: 'Name' }"></span>
                                    </div>
                                </script>
                            </div>

                        </div>
                        <div data-bind="if: Groups">
                            <h4>Manage groups</h4>
                            <div data-bind="jayGrid: {  source: Groups, items: allGroups }"></div>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="DeploymentUI" data-bind="if: visible">

                        <!--ko if: adminApiClient.publishSuccess() == 0-->
                        <div class="thumbnails small">
                            <div class="wrapper-mini">
                                <ul>
                                    <li class="thumbnail active" onclick="slideclick(event, this);" id="0">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2><i class="icon-ok icon-white"></i></h2>
                                        </div>
                                        <h3>Define DB</h3>
                                    </li>
                                    <li class="thumbnail active">
                                        <div class="box box-mini box-circle box-jayblue" onclick="slideclick(event, this);" id="1">
                                            <h2><i class="icon-ok icon-white"></i></h2>
                                        </div>
                                        <h3>Create logic</h3>
                                    </li>
                                    <li class="thumbnail active">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2>3</h2>
                                        </div>
                                        <h3>Publish API</h3>
                                    </li>
                                    <li class="thumbnail" onclick="slideclick(event, this);" id="9">
                                        <div class="box box-mini box-circle box-gray">
                                            <h2>4</h2>
                                        </div>
                                        <h3>API Access</h3>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--/ko-->

                        <h1>Application Publish</h1>
                        <div data-bind="attr: { class: adminApiClient.publishSuccess() == 0 ? 'alert alert-info fade in clear margint50' : 'alert alert-info fade in clear' }">
                            <button type="button" class="close" data-dismiss="alert">x</button>
                            <p>Here you can implement all modifications within your configuration onto all the dedicated virtual servers of the application environment.</p>
                        </div>
                        <div data-bind="if: appContext">
                            <input type="button" data-bind="click: launch, attr: { disabled: launchDisabled }" value="Deploy changes and restart services" class="btn btn-info btn-deploy">

                            <h3 data-bind="if: launchInit">Collecting changed data, please wait...</h3>
                            <h3 data-bind="if: launching">Publish in progress, please wait...</h3>
                            <h3 data-bind="if: launchingDone">Publish done!</h3>
                        </div>
                        <div data-bind="if: hasChanges" style="margin-bottom: 20px">
                            <h3>Changed ApplicationDB items</h3>
                            <div data-bind="foreach: changedObjects">
                                <div data-bind="if: Items().length > 0">
                                    <h4 data-bind="text: CollectionName"></h4>
                                    <ul class="cyan_list" data-bind="foreach: Items">
                                        <!-- ko if: _wrappedType.memberDefinitions.getMember('Name') -->
                                        <li><span data-bind="text: Name"></span></li>
                                        <!-- /ko -->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="DataManagerUI" data-bind="if: visible">
                        <h1>Data Manager</h1>

                        <div class="alert alert-info fade in">
                            <button type="button" class="close" data-dismiss="alert">&#120;</button>
                            <p>Data manager has been opened in a separate window!</p>
                        </div>
                    </div>
                </div>
                <div class="tab-content-item tab-pane fade">
                    <div id="AccessClientsUI" data-bind="if: visible">

                        <!--ko if: adminApiClient.publishSuccess() == 0-->
                        <div class="thumbnails small">
                            <div class="wrapper-mini">
                                <ul>
                                    <li class="thumbnail active" onclick="slideclick(event, this);" id="0">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2><i class="icon-ok icon-white"></i></h2>
                                        </div>
                                        <h3>Define DB</h3>
                                    </li>
                                    <li class="thumbnail active" onclick="slideclick(event, this);" id="1">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2><i class="icon-ok icon-white"></i></h2>
                                        </div>
                                        <h3>Create logic</h3>
                                    </li>
                                    <li class="thumbnail active" onclick="slideclick(event, this);" id="7">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2><i class="icon-ok icon-white"></i></h2>
                                        </div>
                                        <h3>Publish API</h3>
                                    </li>
                                    <li class="thumbnail active" onclick="slideclick(event, this);" id="9">
                                        <div class="box box-mini box-circle box-jayblue">
                                            <h2>4</h2>
                                        </div>
                                        <h3>API Access</h3>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--/ko-->

                        <h1>API access tutorials</h1>

                        <div data-bind="attr: { class: adminApiClient.publishSuccess() == 0 ? 'alert alert-info fade in clear margint50' : 'alert alert-info fade in clear' }">
                            <button type="button" class="close" data-dismiss="alert">x</button>
                            <p>After you have successfully published your JayStorm application, you can access your JayStorm services through standards based OData protocol in every language or application which supports OData. Below you can find a few code snippet examples and tutorials for each of your services in different languages and applications. See more info in the tutorials.</p>
                        </div>

                        <ul class="nav nav-tabs" data-bind="foreach:services">
                            <li><a href="#" data-bind="text:Name,click: $root.currentService.bind($data), attr: { 'data-servicename': Name }"></a></li>
                        </ul>

                        <div data-bind="if: data">
                            <h5 class="muted">API URL: <a class="jayblue" data-bind="text: adminApiClient.currentApplication().url + $root.currentService().Name() + '/', attr: { href: adminApiClient.currentApplication().url + $root.currentService().Name() + '/' }" target="_blank"></a></h5>
                            <div class="tabbable">
                                <ul class="nav nav-tabs reset-m" data-bind="foreach: embedTemplates, attr: { id: 'embed-service-' + $root.currentService().ServiceID() }">
                                    <li style="text-align: center;">
                                        <a data-toggle="tab" data-bind="click: function(){ $root.renderTemplate('service-template-' + name + '-' + $root.currentService().ServiceID(), name, $data); }, attr: { href: '#service-template-' + name + '-' + $root.currentService().ServiceID() }">
                                            <span data-bind="text: title"></span>
                                            <br />
                                            <i data-bind="if: cssclass, attr: { class: cssclass }"></i>
                                        </a>
                                    </li>
                                </ul>
                                <div class="tab-content" data-bind="foreach: embedTemplates">
                                    <div class="tab-pane fade" data-bind="attr: { id: 'service-template-' + name + '-' + $root.currentService().ServiceID() }"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="welcome">
        <div data-bind="if :authorization">
            <div class="thumbnails big">
                <div class="wrapper">
                    <h1>Steps to create your application</h1>
                    <p class="muted">If you just started developing an Application you should go throught these simple steps listed below.</p>

                    <ul>
                        <li class="thumbnail" onclick="slideclick(event, this);" id="0">
                            <div class="box box-medium box-circle box-jayblue">
                                <span class="icon_70x70 db">&nbsp;</span>
                            </div>
                            <h3>Define your database</h3>
                            <p>If your application needs to store data, create tables and fields to describe its shape.</p>
                        </li>
                        <li class="thumbnail" onclick="slideclick(event, this);" id="1">
                            <div class="box box-medium box-circle box-jayblue"><span class="icon_70x70 blogic">&nbsp;</span></div>
                            <h3>Create business logic</h3>
                            <p>Need to create custom API functionality? Develop your server side business logic with JavaScript.</p>
                        </li>
                        <li class="thumbnail" onclick="slideclick(event, this);" id="7">
                            <div class="box box-medium box-circle box-jayblue"><span class="icon_70x70 publish-big">&nbsp;</span></div>
                            <h3>Publish your API</h3>
                            <p>Automatic REST API to CRUD and Query your data or access your business logic.</p>
                        </li>
                        <li class="thumbnail" onclick="slideclick(event, this);" id="9">
                            <div class="box box-medium box-circle box-jayblue"><span class="icon_70x70 devices-big">&nbsp;</span></div>
                            <h3>Access on all clients</h3>
                            <p>Native client libraries for all major client environments including JavaScript, .NET, Java or Objective-C.</p>
                        </li>
                    </ul>
                </div>
                <!--<div class="blue-line">&nbsp;</div>-->
            </div>

            <div class="wrapper margint10">
                <ul class="feature full">
                    <li>
                        <div class="icon schema">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="0" href="#">Schemas</a></h2>
                            <p>Manage the schema of your tables, add, edit columns, change field types</p>
                        </div>
                    </li>
                    <li>
                        <div class="icon service">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="1" href="#">Service manager</a></h2>
                            <p>Publish your databases or JavaScript API via OData</p>
                        </div>
                    </li>
                    <li>
                        <div class="icon security">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="2" href="#">Security</a></h2>
                            <p>Security manager provides fine-grained access control configuration to your entity sets and services. Assign the available actions for each group</p>
                        </div>
                    </li>
                </ul>
                <ul class="feature full">
                    <li>
                        <div class="icon access">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="3" href="#">Access control / Firewall</a></h2>
                            <p>Control the accessiblity of your app by allow IPs, ports, anonymous visitors, customize request origins</p>
                        </div>
                    </li>
                    <li>
                        <div class="icon file">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="5" href="#">File manager</a></h2>
                            <p>Upload the server-side JavaScript code or static files and we deploy them to all your compute units</p>
                        </div>
                    </li>
                    <li>
                        <div class="icon user">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="5" href="#">Users</a></h2>
                            <p>Manage your users and security groups of your app</p>
                        </div>
                    </li>
                </ul>
                <ul class="feature full">
                    <li>
                        <div class="icon access">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="7" href="#">Publish</a></h2>
                            <p>Here you can implement all modifications within your configuration onto all the dedicated virtual servers of the application environment.</p>
                        </div>
                    </li>
                    <li>
                        <div class="icon devices">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="#" href="#">Access Clients</a></h2>
                            <p>Lorem ipsum is a text that should be seen hwo is the text should be seen is the example. </p>
                        </div>
                    </li>
                    <li>
                        <div class="icon data">&nbsp;</div>
                        <div class="item-content">
                            <h2><a onclick="slideclick(event, this);" id="8" href="#">Data manager</a></h2>
                            <p>Data manager provides front-end to CRUD your all tables in your databases. Editing your ApplicationDb to customize the hebavior of our app. </p>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <div class="first">
        <div id="output"></div>

        <script type="text/html" id="foobar">
            <table class="table"></table>
        </script>

        <script type="text/html" id="embedService">
            <div>
                <a href="#" class="btn btn-danger pull-right marginr10" data-bind="click: closeControlBox"><i class="icon-remove icon-white"></i>Close</a>

                <!--<h3 class="sub-title">API access tutorials</h3>-->
                <!--<p>See how to access your API from different clients.</p>-->
                <!--<h5 class="muted">Service name: <span class="jayblue" data-bind="text: $data.data.owner.Name()"></span></h5>-->
                <h5 class="muted">API URL: <a class="jayblue" data-bind="text: adminApiClient.currentApplication().url + $data.data.owner.Name() + '/', attr: { href: adminApiClient.currentApplication().url + $data.data.owner.Name() + '/' }" target="_blank"></a></h5>
                <div class="tabbable tabs-left">
                    <ul class="nav nav-tabs" data-bind="foreach: embedTemplates, attr: { id: 'embed-service-' + $data.data.owner.ServiceID() }">
                        <li>
                            <!--<i data-bind="if: cssclass, attr: { class: cssclass }"></i>-->
                            <a data-toggle="tab" data-bind="text: title, click: function(){ $parent.renderTemplate('service-template-' + name + '-' + $parent.data.owner.ServiceID(), name, $data); }, attr: { href: '#service-template-' + name + '-' + $parent.data.owner.ServiceID() }"></a>
                        </li>
                    </ul>
                    <div class="tab-content" data-bind="foreach: embedTemplates">
                        <div class="tab-pane fade" data-bind="attr: { id: 'service-template-' + name + '-' + $parent.data.owner.ServiceID() }"></div>
                    </div>
                </div>

                <br />
                <a href="#" class="btn btn-danger pull-right marginr10" data-bind="click: closeControlBox"><i class="icon-remove icon-white"></i>Close</a>
            </div>
        </script>
    </div>

    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-30304727-5']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>
</body>
</html>
